# NotionカレンダーSlack通知システム 要件設計書

## 1. はじめに

### 1.1. 背景・目的
本システムは、Notionで管理されているカレンダーの予定を、指定した時刻にSlackの特定チャンネルへ自動で通知することを目的とする。これにより、チームメンバーや個人がその日の予定を簡単に把握し、業務の効率化を図る。

### 1.2. システム概要
Notion APIを利用してカレンダー情報を取得し、整形した上でSlack API経由でメッセージを投稿する。この一連の処理を**GitHub Actions**を利用して定期的に実行する。

## 2. システム構成

### 2.1. アーキテクチャ
**GitHub Actions** を利用し、追加コストを発生させずにサーバーレスアーキテクチャを構築する。

```mermaid
graph TD
    A[GitHub Actions<br>(スケジュール実行)] -- 定刻になったら実行 --> B{ワークフロー実行環境<br>(Python/Node.jsスクリプト)};
    B -- Notion APIリクエスト --> C[Notionデータベース];
    C -- 今日の予定を返す --> B;
    B -- 整形したメッセージをPOST --> D[Slack<br>(Incoming Webhook URL)];
```

### 2.2. 使用する技術・サービス
| 役割 | サービス/技術 | 備考 |
| :--- | :--- | :--- |
| **実行環境・定期実行** | GitHub Actions | 本システムの運用には十分な無料枠が存在。cronでスケジュール実行。 |
| **開発言語** | Python / Node.js | API連携やデータ加工に適した言語 |
| **Notion連携** | Notion API | Notionのデータベースから情報を取得 |
| **Slack連携** | Slack API (Incoming Webhooks) | Slackへメッセージを投稿 |

## 3. 機能要件

### 3.1. Notionカレンダー連携機能
-   指定されたNotionデータベース（カレンダー）にAPI経由でアクセスできること。
-   実行日の日付に該当するイベント（予定）をすべて取得できること。
-   **Notionデータベースに必要なプロパティ定義:**
    -   本システムが正しく動作するためには、対象のNotionデータベースに以下のプロパティが存在することを前提とする。
    | プロパティ名 (例) | 型 | 内容・役割 |
    | :--- | :--- | :--- |
    | `title` | タイトル | 予定の件名。 |
    | `date` | 日付 | 予定の日時。時刻を含まない「終日」の予定と、時刻を含む予定の両方に対応する。 |
    | `person` | ユーザー | 担当者や参加者。 |
    | `notes` | テキスト | 備考や補足情報。 |

### 3.2. Slack通知機能
-   取得したNotionのイベント情報を元に、可読性の高いメッセージを生成すること。
    -   `date`プロパティに時刻が設定されている場合のみ、時間を表示する。（例: `10:00-11:00`）
    -   `date`プロパティに時刻が設定されていない場合（終日の予定）は、「終日」などの接頭辞をつけて表示する。
    -   `notes`プロパティに内容が記載されている場合のみ、備考としてメッセージに含める。
    -   **メッセージ例:**
        ```
        【今日のカレンダー予定】
        - 終日 Aさん休暇
        - 10:00-11:00 定例ミーティング (担当: Bさん)
        - 14:00-15:00 C社様 打ち合わせ (担当: Dさん, 備考: 事前資料要確認)
        ```
-   指定されたSlackのIncoming Webhook URLに対して、生成したメッセージを送信できること。
-   その日の予定が1件もなかった場合は、その旨を通知するメッセージ（例：「今日の予定はありません」）を送信すること。

### 3.3. 定期実行機能
-   毎日、指定した時刻（例: 平日の朝9時）にシステムを自動で実行できること。

## 4. 非機能要件

### 4.1. パフォーマンス
-   トリガーが発火してから、通常30秒以内にSlackへの通知が完了すること。

### 4.2. コスト
-   GitHub Actionsの無料利用枠の範囲内でシステムを運用し、追加のランニングコストを発生させないこと。

### 4.3. セキュリティ
-   Notion APIキーやSlack Webhook URLなどの機密情報は、ソースコードに直接書き込まない。
-   GitHubリポジトリの**Secrets機能**を利用して機密情報を安全に管理する。これにより、リポジトリを公開（Public）に設定しても、APIキーなどが外部に漏洩することはない。

### 4.4. 運用・保守
-   API連携の失敗や実行時エラーが発生した場合は、ログに記録され、管理者が追跡できるようにすること。
-   Notionデータベースの仕様変更（プロパティ名の変更など）があった場合に、容易に修正できるコード構成であること。

## 5. 開発に必要な情報
システムを構築するにあたり、以下の情報が必要となります。
-   **Notionインテグレーション**
    -   `Notion APIキー (Internal Integration Token)`
    -   予定を取得したいカレンダーの `データベースID`
-   **Slack**
    -   通知を投稿したいチャンネルの `Incoming Webhook URL`
-   **GitHub**
    -   スクリプトとワークフロー設定を管理するための `GitHubリポジトリ`

## 6. 今後の拡張性
-   通知する曜日や時間を柔軟に変更できる設定機能。
-   キーワード（例：「会議」）を含む予定だけを通知するフィルタリング機能。
-   Slackのボタン操作で、明日の予定をオンデマンドで取得できる機能。（※別途サーバー環境が必要になる可能性があります）

## 7. 開発の進め方 (推奨)
1.  **ローカル開発:** まずはローカルマシン上で、Notionからデータを取得し、Slackに通知するスクリプト（PythonまたはNode.js）を作成する。
2.  **GitHubリポジトリ作成:** 作成したスクリプトを管理するためのGitHubリポジトリを作成する。
3.  **機密情報の設定:** GitHubリポジトリの `Settings` > `Secrets and variables` > `Actions` に、以下の情報を登録する。
    -   `NOTION_API_KEY`: NotionのAPIキー
    -   `NOTION_DATABASE_ID`: NotionのデータベースID
    -   `SLACK_WEBHOOK_URL`: SlackのIncoming Webhook URL
4.  **GitHub Actionsワークフロー作成:** `.github/workflows/` ディレクトリに、以下の処理を行うYAMLファイルを作成する。
    -   `on: schedule:` で、毎日定刻に実行するよう設定 (例: `cron: '0 0 * * 1-5'` で平日の日本時間午前9時)
    -   Python/Node.jsの実行環境をセットアップする。
    -   依存ライブラリ（`requests`など）をインストールする。
    -   Secretsに登録した情報を環境変数として読み込み、通知スクリプトを実行する。
